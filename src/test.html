<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>键盘按键特效 - Canvas实现</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        color: #fff;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        overflow-x: hidden;
      }

      header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        width: 100%;
        max-width: 800px;
      }

      h1 {
        font-size: 2.8rem;
        margin-bottom: 10px;
        background: linear-gradient(45deg, #ff7eee, #4facfe);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.2rem;
        opacity: 0.8;
        max-width: 600px;
        margin: 0 auto;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 100%;
        max-width: 1000px;
        gap: 30px;
      }

      .canvas-container {
        position: relative;
        width: 100%;
        height: 400px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(10, 15, 30, 0.7);
      }

      .keyboard {
        width: 100%;
        max-width: 800px;
        background: rgba(30, 35, 60, 0.6);
        border-radius: 12px;
        padding: 25px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .keyboard h2 {
        margin-bottom: 20px;
        font-size: 1.8rem;
        color: #e0e0ff;
      }

      .instructions {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 25px;
      }

      .instruction-card {
        background: rgba(255, 255, 255, 0.08);
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .instruction-card:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.12);
      }

      .key {
        display: inline-block;
        background: linear-gradient(145deg, #3a3a5a, #2a2a4a);
        color: #ffb6ff;
        padding: 5px 12px;
        border-radius: 6px;
        font-weight: bold;
        margin: 0 5px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .effect-preview {
        width: 100%;
        height: 100px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
        margin: 20px 0;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      .effect-bar {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 20px;
        height: 0;
        background: linear-gradient(to top, #ff00cc, #333399);
        border-radius: 10px 10px 0 0;
        animation: effectDemo 2s infinite;
      }

      @keyframes effectDemo {
        0%, 100% { height: 0; }
        25% { height: 100px; }
        75% { height: 30px; }
      }

      .current-key {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 15px;
        color: #ff7eee;
        min-height: 2rem;
      }

      footer {
        margin-top: 30px;
        text-align: center;
        padding: 20px;
        color: rgba(255, 255, 255, 0.6);
        font-size: 0.9rem;
        width: 100%;
      }

      @media (max-width: 600px) {
        h1 { font-size: 2.2rem; }
        .subtitle { font-size: 1rem; }
        .canvas-container { height: 300px; }
      }
    </style>
</head>
<body>
<header>
    <h1>键盘按键特效</h1>
    <p class="subtitle">按下键盘任意键，在Canvas上体验劲乐团风格的按键特效</p>
</header>

<div class="container">
    <div class="canvas-container">
        <canvas id="effectCanvas"></canvas>
    </div>

    <div class="keyboard">
        <h2>按键特效演示</h2>

        <div class="effect-preview">
            <div class="effect-bar"></div>
        </div>

        <p>按下键盘上的任意键，查看特效效果</p>
        <div class="current-key">等待按键...</div>

        <div class="instructions">
            <div class="instruction-card">
                <h3>字母键</h3>
                <p>按下 <span class="key">A</span>-<span class="key">Z</span> 生成蓝色特效</p>
            </div>
            <div class="instruction-card">
                <h3>数字键</h3>
                <p>按下 <span class="key">0</span>-<span class="key">9</span> 生成紫色特效</p>
            </div>
            <div class="instruction-card">
                <h3>功能键</h3>
                <p>按下 <span class="key">Space</span> <span class="key">Enter</span> 生成多彩特效</p>
            </div>
        </div>
    </div>
</div>

<footer>
    <p>Canvas键盘特效实现 | 类似劲乐团的打击效果 | 按任意键开始</p>
</footer>

<script>
  // 获取Canvas元素和上下文
  const canvas = document.getElementById('effectCanvas');
  const ctx = canvas.getContext('2d');
  const currentKeyDisplay = document.querySelector('.current-key');

  // 设置Canvas尺寸为容器尺寸
  function resizeCanvas() {
    canvas.width = canvas.parentElement.clientWidth;
    canvas.height = canvas.parentElement.clientHeight;
  }

  // 初始化调整Canvas大小
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);

  // 存储特效的数组
  const effects = [];

  // 特效类
  class KeyEffect {
    constructor(key, x, y, width) {
      this.key = key;
      this.x = x;
      this.y = y;
      this.width = width;
      this.height = 0;
      this.maxHeight = Math.min(canvas.height * 0.7, 300);
      this.speed = 8 + Math.random() * 4;
      this.phase = 'rising'; // rising, falling
      this.alpha = 1.0;
      this.color = this.getColorForKey(key);
      this.createdAt = Date.now();
    }

    getColorForKey(key) {
      // 根据按键类型返回不同颜色
      if (/^[a-z]$/i.test(key)) {
        // 字母键 - 蓝色系
        return `hsl(${200 + Math.random() * 40}, 80%, 60%)`;
      } else if (/^[0-9]$/.test(key)) {
        // 数字键 - 紫色系
        return `hsl(${270 + Math.random() * 30}, 80%, 65%)`;
      } else {
        // 其他键 - 多彩
        return `hsl(${Math.random() * 360}, 80%, 65%)`;
      }
    }

    update() {
      if (this.phase === 'rising') {
        this.height += this.speed;
        if (this.height >= this.maxHeight) {
          this.height = this.maxHeight;
          this.phase = 'falling';
        }
      } else if (this.phase === 'falling') {
        this.height -= this.speed * 0.7;
        this.alpha -= 0.02;

        if (this.height <= 0 || this.alpha <= 0) {
          this.height = 0;
          return false; // 特效结束
        }
      }
      return true; // 特效继续
    }

    draw() {
      if (this.height <= 0) return;

      const gradient = ctx.createLinearGradient(
        this.x, this.y,
        this.x, this.y - this.height
      );

      // 添加渐变效果
      gradient.addColorStop(0, this.color);
      gradient.addColorStop(0.4, this.color);
      gradient.addColorStop(1, 'rgba(255, 255, 255, 0)');

      ctx.globalAlpha = this.alpha;
      ctx.fillStyle = gradient;

      // 绘制圆角矩形
      ctx.beginPath();
      const radius = this.width / 2;
      ctx.moveTo(this.x + radius, this.y);
      ctx.lineTo(this.x + this.width - radius, this.y);
      ctx.quadraticCurveTo(this.x + this.width, this.y, this.x + this.width, this.y - radius);
      ctx.lineTo(this.x + this.width, this.y - this.height + radius);
      ctx.quadraticCurveTo(this.x + this.width, this.y - this.height, this.x + this.width - radius, this.y - this.height);
      ctx.lineTo(this.x + radius, this.y - this.height);
      ctx.quadraticCurveTo(this.x, this.y - this.height, this.x, this.y - this.height + radius);
      ctx.lineTo(this.x, this.y - radius);
      ctx.quadraticCurveTo(this.x, this.y, this.x + radius, this.y);
      ctx.closePath();
      ctx.fill();

      // 重置透明度
      ctx.globalAlpha = 1.0;
    }
  }

  // 动画循环
  function animate() {
    // 清除画布，使用半透明黑色实现拖尾效果
    ctx.fillStyle = 'rgba(10, 15, 30, 0.15)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // 更新并绘制所有特效
    for (let i = effects.length - 1; i >= 0; i--) {
      const effect = effects[i];
      const isAlive = effect.update();

      if (isAlive) {
        effect.draw();
      } else {
        effects.splice(i, 1);
      }
    }

    // 绘制底部参考线
    ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, canvas.height - 2);
    ctx.lineTo(canvas.width, canvas.height - 2);
    ctx.stroke();

    requestAnimationFrame(animate);
  }

  // 处理键盘事件
  function handleKeyDown(e) {
    // 阻止默认行为以避免页面滚动等
    if ([32, 37, 38, 39, 40].includes(e.keyCode)) {
      e.preventDefault();
    }

    const key = e.key.toUpperCase();
    currentKeyDisplay.textContent = `当前按键: ${key}`;

    // 创建特效
    const effectWidth = 20 + Math.random() * 30;
    const x = canvas.width / 2 + (Math.random() - 0.5) * 200;
    const effect = new KeyEffect(key, x, canvas.height, effectWidth);
    effects.push(effect);
  }

  // 添加键盘事件监听
  window.addEventListener('keydown', handleKeyDown);

  // 触摸设备提示
  if ('ontouchstart' in window) {
    currentKeyDisplay.textContent = "提示：在触摸设备上，请使用外接键盘或点击这里模拟按键";
    currentKeyDisplay.addEventListener('click', () => {
      const keys = ['A', 'S', 'D', 'F', 'J', 'K', 'L', 'ENTER', 'SPACE'];
      const randomKey = keys[Math.floor(Math.random() * keys.length)];
      currentKeyDisplay.textContent = `模拟按键: ${randomKey}`;

      const effectWidth = 20 + Math.random() * 30;
      const x = canvas.width / 2 + (Math.random() - 0.5) * 200;
      const effect = new KeyEffect(randomKey, x, canvas.height, effectWidth);
      effects.push(effect);
    });
  }

  // 开始动画
  animate();
</script>
</body>
</html>
